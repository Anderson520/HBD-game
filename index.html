<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Â∞èÂØ∏Â∞çÊ±∫</title>
    <style>
        :root { --p1-color: #ff85a2; --p2-color: #4cc9f0; --accent-color: #f72585; --bg-color: #fff5f7; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: sans-serif; background-color: var(--bg-color); overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        #status-bar { margin-top: 15px; font-size: 18px; font-weight: bold; color: #333; height: 30px; }
        #player-info { display: flex; gap: 10px; margin: 10px 0; }
        .p-tag { padding: 6px 12px; border-radius: 20px; font-size: 12px; background: white; border: 2px solid #ddd; color: #888; }
        .p-tag.active { border-color: var(--accent-color); transform: scale(1.1); font-weight: bold; }
        .p1-active.active { background: var(--p1-color); color: white; border-color: var(--p1-color); }
        .p2-active.active { background: var(--p2-color); color: white; border-color: var(--p2-color); }
        #game-container { position: relative; width: 92vw; height: 92vw; max-width: 400px; max-height: 400px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 10px; }
        .board { display: grid; grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(6, 1fr); gap: 4px; width: 100%; height: 100%; }
        .cell { background: #fff0f3; border-radius: 8px; display: flex; justify-content: center; align-items: center; font-size: 11px; border: 1px solid #ffdeeb; font-weight: bold; text-align: center; }
        .cell.special { background: #ffd166; color: #555; }
        .cell.upgrade { background: #06d6a0; color: white; }
        .cell.start { background: var(--accent-color); color: white; }
        .player-token { position: absolute; width: 30px; height: 30px; z-index: 10; transition: all 0.3s ease; border-radius: 50%; border: 2px solid white; object-fit: cover; pointer-events: none; }
        .dice-box { width: 70px; height: 70px; background: white; border-radius: 15px; display: flex; justify-content: center; align-items: center; font-size: 32px; font-weight: bold; color: var(--accent-color); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 3px solid var(--accent-color); margin: 15px 0; cursor: pointer; }
        .rolling { animation: shake 0.1s infinite; opacity: 0.5; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -1px); } }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 85%; max-width: 320px; border-radius: 20px; padding: 20px; text-align: center; }
        .modal-content img { width: 100%; border-radius: 12px; margin-bottom: 12px; display: none; }
        #close-btn { background: var(--accent-color); color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; cursor: pointer; margin-top: 10px; font-size: 16px; }
    </style>
</head>
<body>

    <div id="status-bar">Ê∫ñÂÇôÂ•ΩÈñãÂßã‰∫ÜÂóéÔºü</div>
    <div id="player-info">
        <div id="p1-tag" class="p-tag p1-active">P1: Â∞èÂØ∏Â≠ê (D4)</div>
        <div id="p2-tag" class="p-tag p2-active">P2: Â∞èÂØ∏Â≠ê (D4)</div>
    </div>

    <div id="game-container">
        <img id="p1-token" class="player-token" src="me.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=P1&background=ff85a2&color=fff'">
        <img id="p2-token" class="player-token" src="you.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=P2&background=4cc9f0&color=fff'">
        <div class="board" id="board"></div>
    </div>

    <div class="dice-box" id="dice-btn">?</div>
    <button onclick="location.reload()" style="background:none; border:none; color:#aaa; cursor:pointer;">ÈáçÊñ∞ÈñãÂßã</button>

    <div id="modal">
        <div class="modal-content">
            <h3 id="modal-title" style="color:var(--accent-color); margin:0;"></h3>
            <img id="modal-img" src="">
            <p id="modal-text"></p>
            <button id="close-btn">ÁπºÁ∫åÂâçÈÄ≤</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        const mapPhotos = ["p1.jpeg", "p2.jpeg", "p3.jpeg", "p4.jpeg", "p5.jpeg", "p6.jpeg", "p7.jpeg", "p8.jpeg", "p9.jpeg", "p10.jpeg"];
        const mapTexts = ["Êñ∞Âä†Âù°ÂãïÁâ©ÂúíÈÅáË¶ãÁãêÁå¥ Ë∂ÖËêåÔºÅ", "Áí∞ÁêÉÂ•áÊÄ™Ëá™Êãç", "Êñ∞Âä†Âù°ÂêàÁÖß ÂÖÑÂºüÊâãÊ∞£ÁàÜÊ£ö", "......", "ÂÖßË°£Â§ßÁõú", "Á¨¨‰∏ÄÊ¨°‰∏ÄËµ∑ÊªëÈõ™ÔºåÂ•ΩÁé©ÔºÅ", "ÊàêÁÇ∫ËñØÁ≤â", "Ë¢´Â∞èÂçóÂØµÂπ∏", "‰∏ÄËµ∑Â†ÜÁöÑÈõ™Âú∞Â∞èÁôΩ", "ÈÄôÂºµÁ¥îÁ≤πÂà∑Âà∞ ÂæàÂ•ΩÁ¨ëÂìà"];
        const eventPhotos = { mini: "e1.jpeg", tired: "e2.jpeg", scratch: "e3.jpeg", pokemon: "e4.jpeg", nuo: "e5.jpeg", racing: "e6.jpeg", ceng: "e7.jpeg" };
        const rankNames = { 4: "Â∞èÂØ∏Â≠ê", 6: "ÂØ∏Ê§ç", 10: "Â§ßÊ§ç", 15: "ÂØ¶ÁøíÂØ∏Á•û" };

        let players = [
            { id: 1, pos: 0, dice: 4, token: 'p1-token', tag: 'p1-tag', skip: 0, tired: 0, rev: false },
            { id: 2, pos: 0, dice: 4, token: 'p2-token', tag: 'p2-tag', skip: 0, tired: 0, rev: false }
        ];
        let turn = 0;
        let busy = false;

        const layout = ['Start','M','S','M','M','S','U','M','S','M','S','M','M','S','U','M','S','M','S','M'];
        const grid = [[1,1],[1,2],[1,3],[1,4],[1,5],[1,6],[2,6],[3,6],[4,6],[5,6],[6,6],[6,5],[6,4],[6,3],[6,2],[6,1],[5,1],[4,1],[3,1],[2,1]];

        function init() {
            const b = document.getElementById('board');
            let mCount = 0;
            layout.forEach((t, i) => {
                const c = document.createElement('div');
                c.className = 'cell';
                c.style.gridRow = grid[i][0]; c.style.gridColumn = grid[i][1];
                if(t === 'Start') { c.innerText = "START"; c.classList.add('start'); }
                else if(t === 'S') { c.innerText = "Ôºü"; c.classList.add('special'); }
                else if(t === 'U') { c.innerText = "UP"; c.classList.add('upgrade'); }
                else { c.innerText = "‚ù§"; c.dataset.idx = mCount % 10; mCount++; }
                b.appendChild(c);
            });
            refresh();
        }

        document.getElementById('dice-btn').onclick = function() {
            if(busy) return;
            const p = players[turn];
            if(p.skip > 0) {
                p.skip--;
                show("Á§æÂçÄÊúçÂãô‰∏≠...", eventPhotos.mini, "ÈÇÑÊ≤íÂÆåÊàêÊúçÂãôÔºå‰∏ã‰∏Ä‰ΩçÔºÅ", endTurn);
                return;
            }
            this.classList.add('rolling');
            setTimeout(() => {
                this.classList.remove('rolling');
                let roll = Math.floor(Math.random() * p.dice) + 1;
                if(p.tired > 0) { p.tired--; roll = 1; }
                if(p.rev) { p.rev = false; roll = -roll; }
                this.innerText = Math.abs(roll);
                busy = true;
                move(p, roll);
            }, 600);
        };

        function move(p, steps) {
            if(steps === 0) { landing(p); return; }
            const dir = steps > 0 ? 1 : -1;
            p.pos = (p.pos + dir + 20) % 20;
            if(p.pos === 0 && dir === 1) { 
                if(p.dice === 15) { p.isVictory = true; } // D15ÁπûÂÆå‰∏ÄÂúà Ê®ôË®òÂãùÂà©
                else {
                    const next = { 4: 6, 6: 10, 10: 15 };
                    p.dice = next[p.dice];
                    p.passed = true;
                }
            }
            refresh();
            setTimeout(() => move(p, steps > 0 ? steps - 1 : steps + 1), 250);
        }

        function landing(p) {
            // ÂÖàÊ™¢Êü•ÊòØÂê¶ÈÅîÊàêÂãùÂà©Ê¢ù‰ª∂
            if(p.isVictory) {
                confetti(); 
                show("üéä ÊÅ≠Âñú üéä", "", "ÊàêÁÇ∫ÊúÄÂº∑ÂØ∏Á•ûÔºÅ\nÁîüÊó•Âø´Ê®ÇÔºÅüíñ ‰Ω†Ë¥è‰∫ÜÂóéÔºü", () => location.reload());
                return;
            }
            // ËôïÁêÜÊôÆÈÄöÁöÑÁπûÂúàÂçáÁ¥öÂΩàÁ™ó
            if(p.passed) {
                p.passed = false;
                show("ÂçáÊ§çÔºÅ‚ú®", "", "È†ÜÂà©ÁπûÂÆå‰∏ÄÂúàÔºÅ\nÊôâÁ¥öÁÇ∫„Äê" + rankNames[p.dice] + "„Äë\n(D" + p.dice + ")", () => landing(p));
                return;
            }

            const t = layout[p.pos];
            if(t === 'U') {
                if(p.dice === 15) { 
                    confetti(); 
                    show("üéä ÊÅ≠Âñú üéä", "", "ÊàêÁÇ∫ÊúÄÂº∑ÂØ∏Á•ûÔºÅ\nÁîüÊó•Âø´Ê®ÇÔºÅüíñ ‰Ω†Ë¥è‰∫ÜÂóéÔºü", () => location.reload());
                } else {
                    const next = { 4: 6, 6: 10, 10: 15 };
                    p.dice = next[p.dice];
                    show("ÂçáÊ§çÔºÅ‚ú®", "", "Ë∏©Âà∞ÂçáÁ¥öÊ†ºÔºÅ\nÊôâÁ¥öÁÇ∫„Äê" + rankNames[p.dice] + "„Äë\n(D" + p.dice + ")", endTurn);
                }
            } else if(t === 'S') {
                const evs = [
                    () => { p.skip = 2; show("ÂÅáÂÜíÂØ∏Á•ûÔºåË¢´Ë≤∂ÁÇ∫Ëø∑‰Ω†ÂØ∏", eventPhotos.mini, "ÂÖ©ÂõûÂêàÂÖßÁÑ°Ê≥ïË°åÂãï„ÄÇ", endTurn); },
                    () => { p.tired = 3; show("Á¥ØÁ¥ØÁóÖÁôº‰Ωú", eventPhotos.tired, "‰∏ã‰∏âÂõûÂêàÂè™ËÉΩËµ∞‰∏ÄÊ≠•„ÄÇ", endTurn); },
                    () => { 
                        if(p.dice === 15) { p.isVictory = true; landing(p); return; }
                        const next = { 4: 6, 6: 10, 10: 15 }; p.dice = next[p.dice];
                        const opp = players[1-turn]; opp.pos = (opp.pos + 3) % 20;
                        show("Êèê‰æõÊäìËÉåÊúçÂãô", eventPhotos.scratch, "Ëá™Â∑±ÂçáÁ¥öÔºåÂ∞çÊñπÂâçÈÄ≤‰∏âÊ†ºÔºÅ", () => { refresh(); endTurn(); });
                    },
                    () => { p.rev = true; show("Ê≤àËø∑ÊäìÂØ∂Ëø∑Ë∑Ø‰∫Ü", eventPhotos.pokemon, "‰∏ãÂõûÂêàÂæÄÂæåËµ∞„ÄÇ", endTurn); },
                    () => { p.pos = (p.pos - 3 + 20) % 20; show("Ë¢´Â∞èË´æÈ®∑ÊìæËÄΩË™§", eventPhotos.nuo, "ÂæåÈÄÄ 3 Ê†º„ÄÇ", () => { refresh(); endTurn(); }); },
                    () => { 
                        players[0].pos = (players[0].pos + 4) % 20; players[1].pos = (players[1].pos + 4) % 20;
                        show("È£ÜËªäÔºÅ", eventPhotos.racing, "ÂÖ©‰∫∫‰∏ÄËµ∑ÂâçÈÄ≤ 4 Ê†ºÔºÅ", () => { refresh(); endTurn(); });
                    },
                    () => { show("ÂíåËπ≠Â≠êÁé©", eventPhotos.ceng, "Â∞±ÂæàÂèØÊÑõ„ÄÇ", endTurn); }
                ];
                evs[Math.floor(Math.random() * evs.length)]();
            } else if(t === 'M') {
                const i = document.getElementsByClassName('cell')[p.pos].dataset.idx;
                show("ÊàëÂÄë‰∏ÄËµ∑...", mapPhotos[i], mapTexts[i], endTurn);
            } else {
                endTurn();
            }
        }

        function show(title, img, txt, cb) {
            document.getElementById('modal-title').innerText = title;
            const im = document.getElementById('modal-img');
            if(img) { im.src = img; im.style.display = 'block'; } else { im.style.display = 'none'; }
            document.getElementById('modal-text').innerText = txt;
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('close-btn').onclick = () => {
                document.getElementById('modal').style.display = 'none';
                if(cb) cb();
            };
        }

        function endTurn() {
            busy = false;
            turn = 1 - turn;
            refresh();
        }

        function refresh() {
            players.forEach((p, i) => {
                const tag = document.getElementById(p.tag);
                tag.innerText = `P${p.id}: ${rankNames[p.dice]} (D${p.dice})`;
                tag.className = `p-tag ${i===0?'p1-active':'p2-active'} ${i===turn?'active':''}`;
                const cell = document.getElementsByClassName('cell')[p.pos];
                const br = document.getElementById('game-container').getBoundingClientRect();
                const cr = cell.getBoundingClientRect();
                const el = document.getElementById(p.token);
                el.style.left = (cr.left - br.left + cr.width/2 - 15 + (p.id===1?-5:5)) + 'px';
                el.style.top = (cr.top - br.top + cr.height/2 - 15 + (p.id===1?-5:5)) + 'px';
            });
            document.getElementById('status-bar').innerText = `Ëº™Âà∞ Áé©ÂÆ∂ ${players[turn].id}`;
        }

        init();
        window.onresize = refresh;
    </script>
</body>
</html>
